{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h1>Data Exploration</h1>
    <p>Explore and analyze the datasets used in the course.</p>

    <div class="dataset-selector">
        <h2>Select a Dataset</h2>
        <select id="dataset-select">
            <option value="">-- Choose a dataset --</option>
            <option value="https://raw.githubusercontent.com/dataprofessor/data/master/delaney.csv">Delaney Dataset</option>
            <!-- Add more dataset options as needed -->
        </select>
        <input type="text" id="dataset-url" placeholder="Enter dataset URL">
        <button id="load-dataset" class="btn btn-primary">Load Dataset</button>
    </div>

    <div id="dataset-info" style="display: none;">
        <h2>Dataset Information</h2>
        <p id="dataset-description"></p>
        <p>Number of samples: <span id="dataset-samples"></span></p>
        <p>Number of features: <span id="dataset-features"></span></p>
        <div class="dataset-actions">
            <button id="copy-dataset-info" class="btn btn-primary"><i class="fas fa-copy"></i> Copy</button>
            <a id="download-dataset" class="btn btn-success" href="#" download><i class="fas fa-download"></i> Download</a>
        </div>
    </div>

    <div id="data-summary" style="display: none;">
        <h2>Data Summary</h2>
        <table id="summary-table" class="table">
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>Mean</th>
                    <th>Median</th>
                    <th>Standard Deviation</th>
                    <th>Min</th>
                    <th>Max</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="data-visualization" style="display: none;">
        <h2>Data Visualization</h2>
        <div class="row">
            <div class="col-md-6">
                <div id="histogram"></div>
            </div>
            <div class="col-md-6">
                <div id="boxplot"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div id="scatterplot"></div>
            </div>
        </div>
    </div>

    <div id="feature-importance" style="display: none;">
        <h2>Feature Importance</h2>
        <div id="importance-chart"></div>
    </div>

    <div id="related-modules" style="display: none;">
        <h2>Related Modules</h2>
        <ul id="module-list"></ul>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    $(document).ready(function() {
        $('#dataset-select').change(function() {
            var selectedDataset = $(this).val();
            $('#dataset-url').val(selectedDataset);
        });

        $('#load-dataset').click(function() {
    var datasetUrl = $('#dataset-url').val();
    if (datasetUrl !== '') {
        // Make an API request to fetch dataset information and data
        $.ajax({
            url: '/api/datasets',
            method: 'POST',
            data: JSON.stringify({ url: datasetUrl }),
            contentType: 'application/json',
            success: function(response) {
                // Update dataset information
                $('#dataset-name').text(response.name);
                $('#dataset-description').text(response.description);
                $('#dataset-samples').text(response.num_samples);
                $('#dataset-features').text(response.num_features);

                // Show the dataset information section
                $('#dataset-info').show();

                // Update data summary table
                var summaryTableBody = $('#summary-table tbody');
                summaryTableBody.empty();
                // Assuming the response contains summary data for each feature
                $.each(response.summary, function(feature, values) {
                    var row = '<tr>' +
                        '<td>' + feature + '</td>' +
                        '<td>' + values.mean.toFixed(2) + '</td>' +
                        '<td>' + values.median.toFixed(2) + '</td>' +
                        '<td>' + values.std.toFixed(2) + '</td>' +
                        '<td>' + values.min.toFixed(2) + '</td>' +
                        '<td>' + values.max.toFixed(2) + '</td>' +
                        '</tr>';
                    summaryTableBody.append(row);
                });
                $('#data-summary').show();

                // Update data visualization
                // Assuming the response contains the necessary data for visualization
                // Update the plotly.js charts or any other visualization libraries used

                // Show the data visualization section
                $('#data-visualization').show();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                var errorMessage = jqXHR.responseJSON.error;
                alert('Error occurred while fetching dataset: ' + errorMessage);
            }
        });
    } else {
        alert('Please select a dataset or enter a dataset URL.');
    }
});
    });
</script>
{% endblock %}